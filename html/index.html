<!DOCTYPE html>
<html>
  <head>
    <title>Ether Vending Machine</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="BokkyPooBah's Smart Contract Vending Machine (c) Bok Consulting Pty Ltd 2019">
    <meta name="author" content="BokkyPooBah/bokconsulting.com.au">
    <link href="css/bootstrap.css" rel="stylesheet" media="screen" />
    <link href="css/bootstrap-theme.min.css" rel="stylesheet" media="screen" />
    <link href="css/app.css" rel="stylesheet" media="screen" />
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bignumber.min.js"></script>
    <script src="js/web3.js"></script>
    <script src="js/app.js"></script>
    <!-- <script src="js/preHFBalances.js"></script> -->

    <link rel="apple-touch-icon" sizes="57x57" href="images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <!-- <link rel="manifest" href="images/manifest.json"> -->
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">


  </head>
  <body>
    <div class="navbar navbar-default" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <i class="icon-menu"></i> Menu
        </button>
        <a class="navbar-brand logo" href="/">Ether Vending Machine</a>
      </div>
      <div class="container">
        <!--
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Decentralised Trustless Exchange Contract Markets">ETH Markets <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/token/1ST"><strong>1ST</strong> <span>First Blood</span></a></li>
                <li><a href="/token/AMIS"><strong>AMIS</strong> <span>AMIS</span></a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/tokenTraderContracts"><i class="icon-star fa-fw"></i> TokenTrader Contracts</a></li>
            <li><a href="/tradeHistory"><i class="icon-star fa-fw"></i> Trade History</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Application Programming Interface">API <b class="caret"></b></a>
              <ul class="dropdown-menu">
                        <li><a href="/api/markets"><i class="icon-star fa-fw"></i> Market Overview</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-header">Tokens</li>
                        <li class="dropdown-header">Contracts</li>
                        <li class="divider"></li>
                        <li><a href="/api/factories"><i class="icon-star fa-fw"></i> Factories</a></li>
              </ul>
            </li>
            <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Help">Help <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="https://github.com/bokkypoobah/TokenTrader/wiki" target="_blank"><i class="icon-star fa-fw"></i> Help</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-header">TokenTraderFactory</li>
                        <li class="divider"></li>
                        <li><a href="https://github.com/bokkypoobah/TokenTrader/wiki/TokenTrader-And-TokenTraderFactory" target="_blank"><i class="icon-star fa-fw"></i> TokenTrader &amp; Factory</a></li>
                        <li class="divider"></li>
                    </ul>
            </li>
          </ul>
        </div>
        -->
      </div>
    </div>

    <div class="container">
      <!-- <h4 class="display-3">Your Ethereum Address</h4> -->
      <form class="form-inline" method="GET">
        <!-- <div class="form-group"> -->
        <div class="row">
          <div class="col-sm-3 text-right">Status:</div>
          <div class="col-sm-8"><span id="status">This page is still under development</span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Network:</div>
          <div class="col-sm-8"><span id="network">Checking ...</span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Latest block number:</div>
          <div class="col-sm-8"><span id="blockNumber"></span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Latest block time:</div>
          <div class="col-sm-8"><span id="blockTime"></span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Your account:</div>
          <div class="col-sm-8"><span id="account"></span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Your account balance:</div>
          <div class="col-sm-8"><span id="accountbalance"></span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Faucets:</div>
          <div class="col-sm-8"><span id="faucets"></span></div>
        </div>
        <!--
        <div class="row">
          <div class="col-sm-3 text-right">Mode:</div>
          <div class="col-sm-3"><span id="mode">(unknown))</span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right"><b>Enter Your Ethereum Address:</b></div>
          <div class="col-sm-8"><input type="text" class="form-control" id="address" name="address" placeholder="0x..." size="48"><button type="submit" class="btn btn-default">Check</button></div>
        </div>
        -->
        <!-- </div> -->

        <br />

        <h4 class="display-3">BokkyPooBah's Fixed Supply Token ðŸ‘Š Factory v1.10</h4>
        <div class="row">
          <div class="col-sm-3 text-right">Address:</div>
          <div class="col-sm-8"><span id="factoryAddress"></span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Minimum fee:</div>
          <div class="col-sm-8"><span id="minimumFee"></span></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">Deployed token contracts:</div>
          <div class="col-sm-8"><span id="deployedContracts"><ul id="deployedContractsList"></ul></span></div>
        </div>

        <br />

        <h4 class="display-3">Your New Token Contract Details</h4>
        <div class="row" id="symbolDiv">
          <div class="col-sm-3 text-right">Symbol:</div>
          <div class="col-sm-3"><input type="text" class="form-control" id="symbol" name="symbol" placeholder="e.g. 'BEANIE'" size="12"></div>
          <span class="help-block" id="symbolNote">Something may have gone wrong</span>
        </div>
        <div class="row has-error" id="nameDiv">
          <div class="col-sm-3 text-right">Name:</div>
          <div class="col-sm-3"><input type="text" class="form-control" id="name" name="name" placeholder="e.g. 'Beanie Things'" size="36"></div>
          <span class="help-block" id="nameNote">Something may have gone wrong</span>
        </div>
        <div class="row has-error" id="decimalsDiv">
          <div class="col-sm-3 text-right">Decimals:</div>
          <div class="col-sm-3"><input type="text" class="form-control" id="decimals" name="decimals" placeholder="0..18" size="5"></div>
          <span class="help-block" id="decimalsNote">Something may have gone wrong</span>
        </div>
        <div class="row has-error" id="totalSupplyDiv">
          <div class="col-sm-3 text-right">Total Supply:</div>
          <div class="col-sm-3"><input type="text" class="form-control" id="totalSupply" name="totalSupply" placeholder=">0 and <= 1 trillion" size="27"></div>
          <span class="help-block" id="totalSupplyNote">Something may have gone wrong</span>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">&nbsp</div>
          <div class="col-sm-3"><button type="submit" class="btn btn-default" name="check" id="check">Check</button></div>
        </div>
        <div class="row">
          <div class="col-sm-3 text-right">&nbsp</div>
          <div class="col-sm-3"><button type="submit" class="btn btn-default" name="deploy" id="deploy" disabled>Deploy</button></div>
          <span class="help-block" id="deployNote"></span>
        </div>
      </form>


      <br />

      <br />
      <!-- <p>URL <span id="url">{url}</span></p> -->
      <!-- <p>Address <span id="address1">{address1}</span></p> -->
      <!-- <p>Mode <span id="mode">{mode}</span></p> -->
      <!-- <p>Block Number <span id="blockNumber">{blockNumber}</span></p> -->
      <br />
      <br />

      <p>Switch networks in MetaMask.</p>
      <p>See <a href="https://etherscan.io/tokens" target="_blank">https://etherscan.io/tokens</a> for list of tokens on the Ethereum Mainnet.</p>
      <br />
      <br />
      <br />
      <br />
      <br />
      <br />
      <br />
      <br />
      <p>Enjoy! &copy; Bok Consulting Pty Ltd 2019 â€¢ Help fund the cost of running this site by donating to <a href="https://etherscan.io/address/0x000001f568875f378bf6d170b790967fe429c81a" target="_blank">0x000001f568875f378bf6d170b790967fe429c81a</a>.</p>
    </div>

<script type="text/javascript">

// Network    Network Id   Chain Id
// Mainnet             1          1
// Ropsten             3          3
// Rinkeby             4          4
// Kovan              42         42
// GÃ¶rli               5          5
// Testnet   | Explorers                     | Testnet ETH Faucets
// :-------- |:----------------------------- |:-------------------------
// Ropsten   | https://ropsten.etherscan.io/ | https://faucet.metamask.io/<br />https://twitter.com/BokkyPooBah/status/1099498823699714048
// Kovan     | https://kovan.etherscan.io/   | https://faucet.kovan.network/<br />https://github.com/kovan-testnet/faucet<br />https://faucet.kovan.radarrelay.com/
// Rinkeby   | https://rinkeby.etherscan.io/ | https://faucet.metamask.io/<br />https://faucet.rinkeby.io/
// GÃ¶rli     | https://goerli.etherscan.io/  | https://faucet.goerli.mudit.blog/<br />https://goerli-faucet.slock.it/<br />https://bridge.goerli.com/

var networks = {
  "-1" : { "network": "(unknown)", "explorer": "(unknown)", "faucets": "(unknown)" },
  "1"  : { "network": "Ethereum Mainnet", "explorer": "https://etherscan.io/", "faucets": "No faucets on Mainnet" },
  "2"  : { "network": "Morden Testnet (deprecated)", "explorer": "https://morden.etherscan.io/", "faucets": "(deprecated)" },
  "3"  : { "network": "Ropsten Testnet", "explorer": "https://ropsten.etherscan.io/", "faucets": "<a href=\"https://faucet.metamask.io/\" target=\"_blank\">https://faucet.metamask.io/</a><br /><a href=\"https://twitter.com/BokkyPooBah/status/1099498823699714048\" target=\"_blank\">https://twitter.com/BokkyPooBah/status/1099498823699714048</a>" },
  "4"  : { "network": "Rinkeby Testnet", "explorer": "https://rinkeby.etherscan.io/", "faucets": "<a href=\"https://faucet.metamask.io/\" target=\"_blank\">https://faucet.metamask.io/</a><br /><a href=\"https://faucet.rinkeby.io/\" target=\"_blank\">https://faucet.rinkeby.io/</a>" },
  "42" : { "network": "Kovan Testnet", "explorer": "https://kovan.etherscan.io/", "faucets": "<a href=\"https://faucet.kovan.network/\" target=\"_blank\">https://faucet.kovan.network/</a><br /><a href=\"https://github.com/kovan-testnet/faucet\" target=\"_blank\">https://github.com/kovan-testnet/faucet</a>" },
  "5"  : { "network": "GÃ¶rli Testnet", "explorer": "https://goerli.etherscan.io/", "faucets": "<a href=\"https://faucet.goerli.mudit.blog/\" target=\"_blank\">https://faucet.goerli.mudit.blog/</a><br /><a href=\"https://goerli-faucet.slock.it/\" target=\"_blank\">https://goerli-faucet.slock.it/</a>" },
};

var factoryAddress = "0xA550114ee3688601006b8b9f25e64732eF774934";
var factoryAbi = [{"constant":false,"inputs":[{"name":"token","type":"address"},{"name":"tokens","type":"uint256"}],"name":"recoverTokens","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_minimumFee","type":"uint256"}],"name":"setMinimumFee","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"minimumFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"numberOfChildren","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"children","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"newAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"symbol","type":"string"},{"name":"name","type":"string"},{"name":"decimals","type":"uint8"},{"name":"totalSupply","type":"uint256"}],"name":"deployTokenContract","outputs":[{"name":"token","type":"address"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newAddress","type":"address"}],"name":"deprecateFactory","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"isChild","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_newAddress","type":"address"}],"name":"FactoryDeprecated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"oldFee","type":"uint256"},{"indexed":false,"name":"newFee","type":"uint256"}],"name":"MinimumFeeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"token","type":"address"},{"indexed":false,"name":"symbol","type":"string"},{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"decimals","type":"uint8"},{"indexed":false,"name":"totalSupply","type":"uint256"}],"name":"TokenDeployed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"}];
var tokenAbi = [{"constant":false,"inputs":[{"name":"token","type":"address"},{"name":"tokens","type":"uint256"}],"name":"recoverTokens","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"}],"name":"init","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"tokenOwner","type":"address"},{"name":"symbol","type":"string"},{"name":"name","type":"string"},{"name":"decimals","type":"uint8"},{"name":"fixedSupply","type":"uint256"}],"name":"init","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"},{"name":"data","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"tokenOwner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Approval","type":"event"}];

var symbolMaxLength = 3;
var nameMaxLength = 10;
var decimalsMax = 18;
var totalSupplyMax = new BigNumber("1").shift(12);

var symbolNote = "Normally a short uppercase character string like 'BEANIE'. Max length " + symbolMaxLength;
var nameNote = "Normally a mixed case character string like 'Beanie Things'. Max length " + nameMaxLength;
var decimalsNote = "A number between 0 and " + decimalsMax + ", inclusive";
var totalSupplyNote = "A number greater than 0 and less than or equals to " + totalSupplyMax;

var txSent = false;
var lastNetworkId;
var lastFactoryAddress;
var lastNumberOfChildren;

const promisify = (inner) =>
  new Promise((resolve, reject) =>
    inner((err, res) => {
      if (err) {
        reject(err);
      } else {
        resolve(res);
      }
    })
  );

async function getData(usersSymbol, usersName, usersDecimals, usersTotalSupply, inputFilled, inputError) {
  var _networkId = promisify(cb => web3.version.getNetwork(cb));
  var _block = promisify(cb => web3.eth.getBlock("latest", cb));
  var _accounts = promisify(cb => web3.eth.getAccounts(cb));
  try {
    var networkId = await _networkId;
    $("#network").html(networkId);
    var network = networks[networkId];
    if (network == null) {
      network = networks[-1];
    }
    $("#network").html(network.network);
    $("#faucets").html(network.faucets);

    $("#factoryAddress").html(factoryAddress + ' <a href="'+ network.explorer + 'address/' + factoryAddress + '#code" target="_blank">ðŸ”—</a>');

    var block = await _block;
    var blockNumber = block.number;
    var timestamp = block.timestamp;
    var now = new Date() / 1000;
    var diff = timestamp - now;
    $("#blockNumber").html(blockNumber + ' <a href="'+ network.explorer + 'block/' + blockNumber + '" target="_blank">ðŸ”—</a>');
    $("#blockTime").html(diff.toFixed(2) + " seconds " + new Date(timestamp * 1000).toUTCString());

    var accounts = await _accounts;
    var account = accounts[0];
    $("#account").html(account + ' <a href="' + network.explorer + 'address/' + account + '#code" target="_blank">ðŸ”—</a>');

    var _balance = promisify(cb => web3.eth.getBalance(account, cb));
    var balance = await _balance;
    $("#accountbalance").html(balance.shift(-18).toString() + " ethers");

    var factory = web3.eth.contract(factoryAbi).at(factoryAddress);
    var _minimumFee = promisify(cb => factory.minimumFee(cb));
    var minimumFee = await _minimumFee;
    $("#minimumFee").html(new BigNumber(minimumFee).shift(-18).toString() + " ethers");

    var _numberOfChildren = promisify(cb => factory.numberOfChildren(cb));
    var numberOfChildren = await _numberOfChildren;

    var deployedContractsList = $('#deployedContractsList');
    deployedContractsList.empty();
    var child = numberOfChildren - 1;
    while (child >= 0) {
      var _childAddress = promisify(cb => factory.children(child, cb));
      var childAddress = await _childAddress;
      var token = web3.eth.contract(tokenAbi).at(childAddress);
      var _symbol = promisify(cb => token.symbol(cb));
      var _name = promisify(cb => token.name(cb));
      var _decimals = promisify(cb => token.decimals(cb));
      var _totalSupply = promisify(cb => token.totalSupply(cb));
      var symbol = await _symbol;
      var name = await _name;
      var decimals = await _decimals;
      var totalSupply = await _totalSupply;
      deployedContractsList.append("<li><a href=\"" + network.explorer + "token/" + childAddress + "\">" + symbol + "</a>, " + name + ", " + decimals + ", " + new BigNumber(totalSupply).shift(-decimals) + " @ " + childAddress + " <a href=\""+ network.explorer + "address/" + childAddress + "#code\" target=\"_blank\">ðŸ”—</a></li>")
      child--;
    }

    if (inputFilled && !inputError && parametersContainKey("deploy")) {
      if (!txSent) {
        $("#deployNote").html('Deploying ...');
        var gas = 1200000;
        if (balance > minimumFee) {
          factory.deployTokenContract(usersSymbol, usersName, usersDecimals, usersTotalSupply.shift(usersDecimals).toString(), {from: account, gas: gas, value: minimumFee}, function(error, tx) {
            if (!error) {
              $("#deployNote").html('Deployed ' + tx + ' <a href="' + network.explorer + 'tx/' + tx + '" target="_blank">ðŸ”—</a>');
            } else {
              $("#deployNote").html('Deployment cancelled. Click Check again before deploying');
              $("#deploy").prop("disabled", true);
            }
          });
        } else {
          $("#deployNote").html('Insufficient funds in your account ' + balance.shift(-18) + ' ethers to pay the minimum fee of ' + minimumFee.shift(-18) + " ethers");
        }
        txSent = true;
      }
    }

  } catch (error) {
    $("#network").html(error);
  }
}

window.addEventListener('load', async () => {

  var inputFilled = true;
  var inputError = false;

  var symbolText = getSearchParameter('symbol');
  var symbolError = false;
  if (symbolText.length == 0) {
    inputFilled = false;
  } else {
    if (symbolText.length > symbolMaxLength) {
      inputError = true;
      symbolError = true;
    }
  }

  var nameText = getSearchParameter('name');
  var nameError = false;
  if (nameText.length == 0) {
    inputFilled = false;
  } else {
    if (nameText.length > nameMaxLength) {
      inputError = true;
      nameError = true;
    }
  }

  var decimalsText = getSearchParameter('decimals');
  var decimalsError = false;
  var decimals;
  if (decimalsText.length == 0) {
    inputFilled = false;
  } else {
    try {
      decimals = parseInt(decimalsText);
      if (isNaN(decimals)) {
        decimals = 999;
      }
      if (decimals > decimalsMax) {
        inputError = true;
        decimalsError = true;
      }
    } catch (e) {
      decimals = decimalsText;
      inputError = true;
      decimalsError = true;
    }
  }

  var totalSupplyText = getSearchParameter('totalSupply');
  var totalSupplyError = false;
  var totalSupply;
  if (totalSupplyText.length == 0) {
    inputFilled = false;
  } else {
    try {
      totalSupply = new BigNumber(totalSupplyText);
      if (isNaN(totalSupply)) {
        totalSupply = new BigNumber(999);
      }
      if (totalSupply.gt(totalSupplyMax)) {
        inputError = true;
        totalSupplyError = true;
      }
    } catch (e) {
      totalSupply = totalSupplyText;
      inputError = true;
      totalSupplyError = true;
    }
  }

  if (symbolError) {
    $("#symbolDiv").addClass("has-error");
    $("#symbolNote").html(symbolNote);
  } else {
    $("#symbolDiv").removeClass("has-error");
    $("#symbolNote").html(symbolNote);
  }
  $("#symbol").val(symbolText);

  if (nameError) {
    $("#nameDiv").addClass("has-error");
    $("#nameNote").html(nameNote);
  } else {
    $("#nameDiv").removeClass("has-error");
    $("#nameNote").html(nameNote);
  }
  $("#name").val(nameText);

  if (decimalsError) {
    $("#decimalsDiv").addClass("has-error");
    $("#decimalsNote").html(decimalsNote);
  } else {
    $("#decimalsDiv").removeClass("has-error");
    $("#decimalsNote").html(decimalsNote);
  }
  $("#decimals").val(decimals);

  if (totalSupplyError) {
    $("#totalSupplyDiv").addClass("has-error");
    $("#totalSupplyNote").html(totalSupplyNote);
  } else {
    $("#totalSupplyDiv").removeClass("has-error");
    $("#totalSupplyNote").html(totalSupplyNote);
  }
  $("#totalSupply").val(totalSupply);

  if (inputFilled && !inputError) {
    $("#deploy").prop("disabled", false);
  } else {
    $("#deploy").prop("disabled", true);
  }
  // $("#symbolDiv").addClass("has-error");
  // $("#symbolText").html("OK");

    // Modern dapp browsers...
    if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        try {
            // Request account access if needed
            await ethereum.enable();
            // Accounts now exposed

            getData(symbolText, nameText, decimals, totalSupply, inputFilled, inputError);
            setInterval(function () {
              getData(symbolText, nameText, decimals, totalSupply, inputFilled, inputError);
            }, 10000);

            //   getData(symbolText, nameText, decimals, totalSupply, inputFilled, inputError);
            //   web3.version.getNetwork((error, netId) => {
            //     if (!error) {
            //       var network = networks[netId];
            //       if (network == null) {
            //         network = networks[-1];
            //       }
            //       // $("#network").html(network.network);
            //       // $("#faucets").html(network.faucets);
            //
            //       // $("#factoryAddress").html(factoryAddress + ' <a href="'+ network.explorer + 'address/' + factoryAddress + '#code" target="_blank">ðŸ”—</a>');
            //
            //       // getLatestBlock();
            //       // $("#blockNumber").html(blockNumber + ' <a href="'+ network.explorer + 'block/' + blockNumber + '" target="_blank">ðŸ”—</a>');
            //       // web3.eth.getBlockNumber((error1, blockNumber) => {
            //       //   if (!error1) {
            //       //     $("#blockNumber").html(blockNumber + ' <a href="'+ network.explorer + 'block/' + blockNumber + '" target="_blank">ðŸ”—</a>');
            //       //     web3.eth.getBlock(blockNumber, (error2, block) => {
            //       //       if (!error2) {
            //       //         $("#blockTime").html(new Date(block.timestamp * 1000).toUTCString());
            //       //       } else {
            //       //         $("#blockTime").html('ERROR ' + error);
            //       //       }
            //       //     });
            //       //   } else {
            //       //     $("#blockNumber").html('ERROR ' + error);
            //       //   }
            //       // });
            //
            //       web3.eth.getAccounts((error, account) => {
            //         if (!error) {
            //           address = account[0];
            //           // $("#account").html(account[0] + ' <a href="' + network.explorer + 'address/' + account[0] + '#code" target="_blank">ðŸ”—</a>');
            //           web3.eth.getBalance(address, function (error, result) {
            //             if (!error) {
            //               var balance = new BigNumber(result);
            //               // $("#accountbalance").html(balance.shift(-18).toString() + " ethers");
            //
            //               var factory = web3.eth.contract(factoryAbi).at(factoryAddress);
            //               // factory.minimumFee(function(error, minimumFee) {
            //               //   if (!error) {
            //               //     $("#minimumFee").html(new BigNumber(minimumFee).shift(-18).toString() + " ethers");
            //               //   } else {
            //               //     $("#minimumFee").html("ERROR");
            //               //   }
            //               // });
            //               var deployedContractsList = $('#deployedContractsList');
            //               factory.numberOfChildren(function(error, numberOfChildren) {
            //                 if (!error) {
            //                   var child = numberOfChildren - 1;
            //                   deployedContractsList.empty();
            //                   while (child >= 0) {
            //                     factory.children(child, function(error, childAddress) {
            //                       if (!error) {
            //                         var token = web3.eth.contract(tokenAbi).at(childAddress);
            //                         token.symbol(function(error, _symbol) {
            //                           if (!error) {
            //                             token.name(function(error, _name) {
            //                               if (!error) {
            //                                 token.decimals(function(error, _decimals) {
            //                                   if (!error) {
            //                                     token.totalSupply(function(error, _totalSupply) {
            //                                       if (!error) {
            //                                         // deployedContractsList.append("<li><a href=\"" + network.explorer + "token/" + childAddress + "\">" + _symbol + "</a>, " + _name + ", " + _decimals + ", " + new BigNumber(_totalSupply).shift(-_decimals) + " @ " + childAddress + " <a href=\""+ network.explorer + "address/" + childAddress + "#code\" target=\"_blank\">ðŸ”—</a></li>")
            //                                       } else {
            //                                       }
            //                                     });
            //                                   } else {
            //                                   }
            //                                 });
            //                               } else {
            //                               }
            //                             });
            //                           } else {
            //                           }
            //                         });
            //                       } else {
            //                       }
            //                     });
            //                     child--;
            //                   }
            //                 } else {
            //
            //                 }
            //               });
            //
            //
            //
            //               if (parametersContainKey("deploy") && false) {
            //                 if (!txSent) {
            //                   $("#deployNote").html('Deploying ...');
            //                   var gas = 1200000;
            //                   factory.minimumFee(function(error, minimumFee) {
            //                     if (!error) {
            //                       // $("#minimumFee").html(factoryAddress + ' <a href="'+ network.explorer + 'address/' + factoryAddress + '#code" target="_blank">ðŸ”—</a>');
            //
            //                       // $("#minimumFee").html("erer");
            //                       // $("#deployNote").html('Minimum fee ' + minimumFee);
            //                       if (balance > minimumFee) {
            //                         factory.deployTokenContract(symbolText, nameText, decimals, totalSupply.shift(decimals).toString(), {from: address, gas: gas, value: minimumFee}, function(error, tx) {
            //                           if (!error) {
            //                             $("#deployNote").html('Deployed ' + tx + ' <a href="' + network.explorer + 'tx/' + tx + '" target="_blank">ðŸ”—</a>');
            //
            //                           } else {
            //                             $("#deployNote").html('Deployment cancelled. Click Check again before deploying');
            //                             $("#deploy").prop("disabled", true);
            //                           }
            //                         });
            //                       } else {
            //                         $("#deployNote").html('Insufficient funds in your account ' + balance.shift(-18) + 'ethers to pay the minimum fee of ' + minimumFee.shift(-18) + " ethers");
            //                       }
            //                     } else {
            //                       $("#deployNote").html('Error retrieving minimum fee');
            //                     }
            //                   });
            //                   txSent = true;
            //                 }
            //               }
            //
            //             } else {
            //               $("#accountbalance").html("ERROR " + error);
            //             }
            //           });
            //         } else {
            //           address = "error";
            //           $("#account").html('ERROR ' + error);
            //         }
            //       });
            //     } else {
            //       $("#network").html("Error " + error);
            //     }
            //   });
            // }, 5000);


            // $("#mode").html(JSON.stringify(await window));
            // web3.eth.sendTransaction({/ * ... * /});
        } catch (error) {
            // User denied account access...
        }
        // Legacy dapp browsers...
    } else if (window.web3) {
        $("#network").html("A 2");
        window.web3 = new Web3(web3.currentProvider);
        // Acccounts always exposed
        getData(symbolText, nameText, decimals, totalSupply, inputFilled, inputError);
        setInterval(function () {
          getData(symbolText, nameText, decimals, totalSupply, inputFilled, inputError);
        }, 10000);
        // web3.eth.sendTransaction({/ * ... * /});
        // Non-dapp browsers...
    } else {
        $("#network").html('Non-Ethereum browser detected. Consider installing the <a href="https://metamask.io/">MetaMask</a> browser addon!');
    }

});

// $(document).ready(function() {

	// $("#url").html(window.location.href);
    // var Web3 = require('web3');
    // var web3 = new Web3();
    // web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
    // var blockNumberCurrent = web3.eth.blockNumber;
	// $("#blockNumber").html(blockNumberCurrent);

/* 	web3.currentProvider.sendAsync({
        method: "blockNumber",
        params: [],
        jsonrpc: "2.0",
        id: "2"
    }, function (err, result) {
        $("#blockNumber").html(err);
    });
 */
    // var ethRpc = "http://localhost:8545";
    // var ethRpc = "https://refunds.thedao.fund/ethrpc";
    // var etcRpc = "https://refunds.thedao.fund/etcrpc";

    /*
    // Checking if Web3 has been injected by the browser (Mist/MetaMask)
    if (typeof web3 !== 'undefined') {
      // Use Mist/MetaMask's provider
      web3js = new Web3(web3.currentProvider);
      $("#mode").html("A 1");
    } else {
      $("#mode").html("A 2");
      console.log('No web3? You should consider trying MetaMask!')
      // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
      web3js = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
    }
    */


    /*
     // Checks Web3 support
    if (typeof web3 !== 'undefined' && typeof Web3 !== 'undefined') {
        // If there's a web3 library loaded, then make your own web3
        web3 = new Web3(web3.currentProvider);
        $("#mode").html("Running in Mist");
        // var blockNumberCurrent = web3.eth.blockNumber;
        // $("#blockNumber").html(blockNumberCurrent);
    } else if (typeof Web3 !== 'undefined') {
        // If there isn't then set a provider
        web3 = new Web3(new Web3.providers.HttpProvider(ethRpc));
        $("#mode").html("Running connected to JSON RPC on " + ethRpc);
        // var blockNumberCurrent = web3.eth.blockNumber;
        // web3.eth.blockNumber(function (error, result) {
        //     $("#blockNumber").html(result);
        // });
        // $("#blockNumber").html(blockNumberCurrent);
        // $("#blockNumber").html("hello");
        // web3.eth.blockNumber(function (error, result) {
        	// $("#blockNumber").html(result);
            // console.log("blockNumber: " + result)
        // });

    } else if (typeof web3 == 'undefined' && typeof Web3 == 'undefined') {
    	$("#blockNumber").html("Not available");
    	return;
    }
    */

	// var blockNumberCurrent = web3.eth.blockNumber;
	// $("#blockNumber").html(blockNumberCurrent);
/*
  var address = getSearchParameter('address');
  console.log("address: " + address);

	if (address != null && address.length == 42) {
	    $("#address").val(address);

	    $('#ethexplorer').attr('href','https://etherscan.io/address/' + address);
        $('#etcexplorer').attr('href','https://gastracker.io/addr/' + address);

	    / *var preHFBalance = getPreHardforkBalance(address);
	    console.log("Pre hard-fork balance: " + preHFBalance);* /
        // $("#preHFBalance").html(preHFBalance);

	    var ethDetails = getETHDetails(address);
	    // console.log(JSON.stringify(ethDetails));
        $("#ethBlockNumber").html(ethDetails.ethBlockNumber);
        $("#ethWithdrawalAmount").html(ethDetails.ethWithdrawalAmount);
        $("#ethExtraBalanceWithdrawalAmount").html(ethDetails.ethExtraBalanceWithdrawalAmount);
        $("#ethAccountBalance").html(ethDetails.ethAccountBalance);

	    var etcDetails = getETCDetails(address);
	    // console.log(JSON.stringify(etcDetails));
        $("#preHFDaoBalance").html(etcDetails.preHFDaoBalance);
        $("#etcBlockNumber").html(etcDetails.etcBlockNumber);
        $("#etcPaidOutAmount").html(etcDetails.etcPaidOutAmount);
        $("#etcWithdrawalAmount").html(etcDetails.etcWithdrawalAmount);
        $("#etcAccountBalance").html(etcDetails.etcAccountBalance);
	}
  */

	// var balances = require('./balancesHR.json');
	// console.table(balances);

    // var blockNumber = web3.eth.getBlockNumber(function (error, result) {
    // 	console.log("blockNumber: " + result)
    // });

    // If no accounts are present, show the floating baloon
    // if (!web3.eth.accounts || web3.eth.accounts.length == 0) {
    // 	console.log("No accounts");
        // document.getElementById("vote-support").style.display = "none";
        // document.getElementById("vote-against").style.display = "none";
        // document.getElementById("add-account").style.display = "block";

    // }

    // var blockNumber = web3.eth.blockNumber;
    // console.log("blockNumber: " + blockNumber)
// });
function processInput(i) {
  return ":" + i + ":" + i + ":";
}
</script>
  </body>
</html>
