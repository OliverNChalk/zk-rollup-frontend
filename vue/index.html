<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Ether Vending Machine In Vue.js</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="BokkyPooBah's Ether Vending Machine (c) Bok Consulting Pty Ltd 2019">
    <meta name="author" content="BokkyPooBah/bokconsulting.com.au">
    <link type="text/css" rel="stylesheet" href="css/bootstrap.css" />
    <link type="text/css" rel="stylesheet" href="css/bootstrap-vue.css"/>
    <link href="css/app.css" rel="stylesheet" media="screen" />
    <!-- <link type="text/css" rel="stylesheet" href="css/theme.css" /> -->
    <!-- <script src="js/polyfill.js"></script> -->
    <script src="js/vue.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
    <!-- <script src="js/bootstrap.js"></script> -->
    <script src="js/bootstrap-vue.js"></script>
    <!-- <script src="js/vue-router.js"></script> -->
    <!-- <script src="js/vuex.js"></script> -->
    <!-- <script src="js/w2ui-1.5.rc1.js"></script> -->
    <script src="js/bignumber.min.js"></script>
    <script src="js/web3.js"></script>

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="images/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="images/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="images/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="images/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="images/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="images/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="images/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="images/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="images/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="images/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="images/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="images/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="images/mstile-310x310.png" />
  </head>
  <body>
    <div id="app">
      <b-container fluid>
        <div>
          <b-navbar type="dark" variant="primary">
            <b-navbar-brand href="#">
              <!-- <img src="images/Me-zoomed.png" style="max-width:53px; margin-top: -16px;" class="d-inline-block align-top" alt="Ether Vending Machine" /> -->
              <img src="images/Me-zoomed.png" style="max-width:30px; margin-top: -4px;" alt="Ether Vending Machine" />
              Ether Vending Machine
            </b-navbar-brand>

            <b-navbar-nav class="ml-auto">
              <!-- Navbar dropdowns -->
              <b-nav-item-dropdown text="Services" right>
                <b-dropdown-item href="#">Deploy Fixed Supply Token Contract</b-dropdown-item>
              </b-nav-item-dropdown>

              <b-nav-item-dropdown text="Pages" right>
                <b-dropdown-item href="#">Token Contract</b-dropdown-item>
              </b-nav-item-dropdown>

              <b-nav-item-dropdown text="Help" right>
                <b-dropdown-item href="#">FAQ</b-dropdown-item>
                <b-dropdown-item href="#">Settings</b-dropdown-item>
              </b-nav-item-dropdown>
            </b-navbar-nav>
          </b-navbar>
        </div>
        <br />

        <div>
          <b-row>
            <b-col cols="12" md="8">
              <b-card title="Deploy Fixed Supply Token Contract" sub-title="BokkyPooBah's Fixed Supply Token 👊 Factory v1.10">
                <b-form @submit="onSubmit" v-if="show">
                <!-- <b-form @submit="onSubmit" @reset="onReset" v-if="show"> -->
                  <b-form-group id="symbolInputGroup" label-for="symbolInput" label="Symbol" horizontal :label-cols="4" description="An uppercase word a few letters long">
                    <b-form-input id="symbolInput" type="text" v-model.trim="symbol" required placeholder="example 'BBC'"></b-form-input>
                  </b-form-group>
                  <b-form-group id="nameInputGroup" label-for="nameInput" label="Name" horizontal :label-cols="4" description="A set of mixed case words">
                    <b-form-input id="nameInput" type="text" v-model.trim="name" required placeholder="example 'Bob's Burgers 🍔 & Chips 🍟 Loyalty Points'"></b-form-input>
                  </b-form-group>
                  <b-form-group id="decimalsInputGroup" label-for="decimalsInput" label="Decimals" horizontal :label-cols="4" description="Number of decimal places, between 0 and 18, inclusive">
                    <b-form-input id="decimalsInput" type="number" v-model.trim="decimals" required placeholder="example '18'"></b-form-input>
                  </b-form-group>
                  <b-form-group id="totalSupplyInputGroup" label-for="totalSupplyInput" label="Total Supply" horizontal :label-cols="4" description="A positive number less than or equals to 100,000,000,000,000">
                    <b-form-input id="totalSupplyInput" type="number" v-model.trim="totalSupply" required placeholder="example '123456.789'"></b-form-input>
                  </b-form-group>
                  <b-form-group id="deploymentFeeInputGroup" label-for="deploymentFeeInput" label="Deployment Fee" horizontal :label-cols="4" description="Minimum deployment fee 0.1 ethers">
                    <b-form-input id="deploymentFeeInput" type="number" v-model.trim="deploymentFee" required placeholder="example 0.123456789"></b-form-input>
                  </b-form-group>
                  <b-form-group label="Show Details: " horizontal :label-cols="4">
                    <b-form-radio-group id="showDetails" v-model="showDetails" name="transactionDataTypeComponent">
                      <b-form-radio value="none" v-b-popover.hover.top="'Don\'t show any details'">None</b-form-radio>
                      <b-form-radio value="functionCall" v-b-popover.hover.top="'For executing using the `geth` JavaScript console'">Function Call</b-form-radio>
                      <b-form-radio value="javascript" v-b-popover.hover.top="'For executing using the `geth` JavaScript console'">JavaScript</b-form-radio>
                      <b-form-radio value="formatted" v-b-popover.hover.top="'For displaying the chunks of raw data'">Formatted</b-form-radio>
                      <b-form-radio value="raw" v-b-popover.hover.top="'This raw data can be copied into MyCrypto or MyEtherWallet for deployment'">Raw</b-form-radio>
                    </b-form-radio-group>
                  </b-form-group>
                  <b-form-group id="transactionDataInputGroup" horizontal :label-cols="4" label-for="transactionDataInput" v-if="showDetails != 'none'" label="Transaction details" :description="getDescription">
                    <b-form-textarea id="transactionDataInput" v-model.trim="getTransactionData" plaintext :wrap="showDetails === 'raw' ? 'soft' : 'off'" rows="10" max-rows="20" ></b-form-textarea>
                  </b-form-group>
                  <b-button variant="primary">Deploy Token Contract</b-button>
                </b-form>
              </b-card>
            </b-col>
            <b-col>
              <b-card title="Network" sub-title="Ethereum network and your account">
                <b-form-group horizontal :label-cols="4" description="An uppercase word a few letters long" label="Symbol">
                  <b-form-input v-model.trim="symbol"></b-form-input>
                </b-form-group>
              </b-card>
              <br />
              <b-card title="Account" sub-title="Ethereum network and your account">
                <b-form-group horizontal :label-cols="4" description="An uppercase word a few letters long" label="Symbol">
                  <b-form-input v-model.trim="symbol"></b-form-input>
                </b-form-group>
              </b-card>
              <br />
              <b-card title="Fixed Supply Token Factory" sub-title="Fixed Supply Token Factory">
                <b-form-group horizontal :label-cols="4" description="An uppercase word a few letters long" label="Symbol">
                  <b-form-input v-model.trim="symbol"></b-form-input>
                </b-form-group>
              </b-card>
            </b-col>
          </b-row>
        </div>
    </div>
    <script type="text/javascript">
    var factoryAddress = "0xA550114ee3688601006b8b9f25e64732eF774934";
    var factoryFullAbi = [{"constant":false,"inputs":[{"name":"token","type":"address"},{"name":"tokens","type":"uint256"}],"name":"recoverTokens","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_minimumFee","type":"uint256"}],"name":"setMinimumFee","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"minimumFee","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"numberOfChildren","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"children","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"newAddress","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"symbol","type":"string"},{"name":"name","type":"string"},{"name":"decimals","type":"uint8"},{"name":"totalSupply","type":"uint256"}],"name":"deployTokenContract","outputs":[{"name":"token","type":"address"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newAddress","type":"address"}],"name":"deprecateFactory","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"isChild","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_newAddress","type":"address"}],"name":"FactoryDeprecated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"oldFee","type":"uint256"},{"indexed":false,"name":"newFee","type":"uint256"}],"name":"MinimumFeeUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"token","type":"address"},{"indexed":false,"name":"symbol","type":"string"},{"indexed":false,"name":"name","type":"string"},{"indexed":false,"name":"decimals","type":"uint8"},{"indexed":false,"name":"totalSupply","type":"uint256"}],"name":"TokenDeployed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"}];
    var factoryAbi = [{"constant":false,"inputs":[{"name":"symbol","type":"string"},{"name":"name","type":"string"},{"name":"decimals","type":"uint8"},{"name":"totalSupply","type":"uint256"}],"name":"deployTokenContract","outputs":[{"name":"token","type":"address"}],"payable":true,"stateMutability":"payable","type":"function"}];
    var tokenAbi = [{"constant":false,"inputs":[{"name":"token","type":"address"},{"name":"tokens","type":"uint256"}],"name":"recoverTokens","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"}],"name":"init","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"acceptOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"tokenOwner","type":"address"},{"name":"symbol","type":"string"},{"name":"name","type":"string"},{"name":"decimals","type":"uint8"},{"name":"fixedSupply","type":"uint256"}],"name":"init","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"tokens","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"tokens","type":"uint256"},{"name":"data","type":"bytes"}],"name":"approveAndCall","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"newOwner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"tokenOwner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"tokenOwner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"tokens","type":"uint256"}],"name":"Approval","type":"event"}];

    var account = "0x07fb31ff47Dc15f78C5261EEb3D711fb6eA985D1";
    var SYMBOLMAXLENGTH = 64;
    var NAMEMAXLENGTH = 128;
    var DECIMALSMAX = 18;
    // var TOTALSUPPLYMAX = new BigNumber("1").shift(14); // 100 trillion
    var TOTALSUPPLYMAX = new BigNumber("1").shift(3); // 1000
    var DEPLOYMENTFEEMAX = new BigNumber("100");

    var DEFAULTDECIMALS = 18;
    var DEFAULTTOTALSUPPLY = new BigNumber("1");
    var FACTORYDEPLOYGAS = 1200000;

    function isSymbolOk(symbol) {
      try {
        return symbol.length > 0 && symbol.length < SYMBOLMAXLENGTH;
      } catch (e) {
      }
      return false;
    }
    function isNameOk(name) {
      try {
        return name.length > 0 && name.length < NAMEMAXLENGTH;
      } catch (e) {
      }
      return false;
    }
    function isDecimalsOk(decimals) {
      if (decimals.length > 0) {
        try {
          return decimals >= 0 && decimals <= DECIMALSMAX;
        } catch (e) {
        }
        return false;
      }
    }
    function isTotalSupplyOk(totalSupply) {
      if (totalSupply.length > 0) {
        try {
          var _totalSupply = new BigNumber(totalSupply);
          return _totalSupply.greaterThan(0) && _totalSupply.lessThanOrEqualTo(TOTALSUPPLYMAX);
        } catch (e) {
        }
        return false;
      }
    }

    var descriptions = {
      "none": "Don't show any details",
      "functionCall": "This is the function call executed",
      "javascript": "For executing using the `geth` JavaScript console",
      "formatted": "For displaying the chunks of raw data",
      "raw": "This raw data can be copied into MyCrypto or MyEtherWallet for deployment",
    }

    window.app = new Vue({
      el: "#app",
      data: {
        symbol: "BBC",
        name: "Bob's Burgers 🍔 & Chips 🍟 Loyalty Points",
        decimals: "18",
        totalSupply: "123.456",
        deploymentFee: "0.123456789",
        transactionData: "0x123456",
        showDetails: "formatted",
        account: "0x07fb31ff47Dc15f78C5261EEb3D711fb6eA985D1",
        errors: [],
        show: true,
      },
      methods: {
        onSubmit(event) {
          event.preventDefault();
          this.name = "submitted";
          alert("hello");
        }
      },
      computed: {
        symbolOk() {
          return isSymbolOk(this.symbol);
        },
        nameOk() {
          return isNameOk(this.name);
        },
        decimalsOk() {
          return isDecimalsOk(this.decimals);
        },
        totalSupplyOk() {
          return isTotalSupplyOk(this.totalSupply);
        },

        getDescription() {
          return descriptions[this.showDetails];
        },

        showAlert() {
          return this.name.length > 4 ? true : false;
        },
        showTransactionData() {
          return this.symbol.length > 0 && this.name.length > 0 && this.decimals > 0 && this.decimals <= 18 && this.totalSupply > 0 && this.totalSupply <= 1000 && this.deploymentFee >= 0.1;
        },
        dataOk() {
          return this.symbol.length > 0 && this.name.length > 0 && this.decimals > 0 && this.decimals <= 18 && this.totalSupply > 0 && this.totalSupply <= 1000 && this.deploymentFee >= 0.1;
        },
        wrapTextArea() {
          return this.showDetails == "raw";
        },
        getTransactionData() {
          var result;
          if (isSymbolOk(this.symbol) && isNameOk(this.name) && isDecimalsOk(this.decimals) && isTotalSupplyOk(this.totalSupply)) {
            if (this.showDetails == "functionCall") {
              result = "deployTokenContract('" + this.symbol + "', '" + this.name + "', " + this.decimals + ", " + new BigNumber(this.totalSupply).shift(this.decimals) + ")";
            } else if (this.showDetails == "javascript") {
              result = "var myAccount = \"" + this.account + "\";\n" +
                "var factoryAddress = \"" + factoryAddress + "\";\n" +
                "var factoryAbi = " + JSON.stringify(factoryAbi) + ";\n" +
                "var factory = web3.eth.contract(factoryAbi).at(factoryAddress);\n" +
                "var tx = factory.deployTokenContract(\"" +this.symbol + "\", \"" + this.name + "\", " + this.decimals + ", " +
                  new BigNumber(this.totalSupply).shift(this.decimals) + ", { from: myAccount, gas: \"" + FACTORYDEPLOYGAS + "\", value: web3.toWei(\"" + this.deploymentFee + "\", \"ether\") });\n" +
                "web3.eth.getTransaction(tx);";
            } else {
              var factory = web3.eth.contract(factoryAbi).at(factoryAddress);
              try {
                result = factory.deployTokenContract.getData(this.symbol, this.name, this.decimals, this.totalSupply, {from: account});
                if (this.showDetails == "formatted") {
                  var offset = 10;
                  var tempResult = result.substring(0, 10) + "\n" + result.substring(10).match(/.{1,64}/g).join("\n");
                  result = tempResult;
                }
              } catch (e) {
                result = e;
              }
            }
          } else {
              result = "Please fill in the input fields above";
          }
          return result;
        }
      }
    })
    </script>
  </body>
</html>
